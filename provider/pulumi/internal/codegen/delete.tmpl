// Code generated by gen.controlresources.go; DO NOT EDIT.

package {{.Package}}

import (
	"context"
{{- if not .WithoutWorkspace}}
	"fmt"
{{- end}}

	"cape-project.eu/sdk-generator/provider/pulumi/config"
	"github.com/pulumi/pulumi-go-provider/infer"
)

func ({{.Name}}) Delete(
	ctx context.Context,
	req infer.DeleteRequest[{{.Name}}State],
) (infer.DeleteResponse, error) {
	config := infer.GetConfig[config.Config](ctx)
	var tenant{{- if not .WithoutWorkspace}}, workspace{{- end}} string
	if req.State.Tenant == nil {
		tenant = config.Tenant
	} else {
		tenant = *req.State.Tenant
	}
{{- if not .WithoutWorkspace}}
	if req.State.Workspace != nil {
		workspace = *req.State.Workspace
	} else if config.Workspace != nil {
		workspace = *config.Workspace
	} else {
		return infer.DeleteResponse{}, fmt.Errorf("workspace not given for {{.Name}} resource %s", req.State.Metadata.Name)
	}
{{- end}}

	client, err := newAPI(ctx, tenant, {{- if not .WithoutWorkspace}} workspace,{{end}} req.State.Metadata.Name)
	if err != nil {
		return infer.DeleteResponse{}, err
	}

	err = client.Delete()
	if err != nil {
		return infer.DeleteResponse{}, err
	}

	return infer.DeleteResponse{}, nil
}
